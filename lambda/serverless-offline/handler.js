'use strict';
const createDBConnection = require('./db');
const Schlesinger = require('./functions/schlesinger');
const Lucid = require('./functions/lucid');
const Purespectrum = require('./functions/purespectrum');

/**
 * Main deployable func
 * @param {*} event 
 * @param {*} context 
 * @returns 
 */
module.exports.surveySync = async (event, context) => {
    // context.callbackWaitsForEmptyEventLoop = true;
    var surveys = [];
    var db = null;
    try {
        if(event.Records) {
            db = createDBConnection();
            const records = event.Records;
            for(let record of records){
                const surveyData = JSON.parse(record.body);
                if ('survey_provider_id' in surveyData) {
                    try {
                        await db.beginTransaction();
                        switch (surveyData.survey_provider_id) {
                            case 1:
                            case '1':
                                const lucid = new Lucid(db, surveyData);
                                var result = await lucid.surveySync();
                                surveys.push(result);
                                break;
                            case 3:
                            case '3':
                                const psObj = new Purespectrum(db, surveyData);
                                var result = await psObj.surveySync();
                                surveys.push(result);
                                break;
                            case 4:
                            case '4':
                                const sch = new Schlesinger(db, surveyData);
                                var result = await sch.surveySync();
                                surveys.push(result);
                                break;
                            default:
                                surveys = []
                        }
                        surveys.push(result);
                        await db.commit();
                    } catch ( err ) {
                        console.log(err)
                        await db.rollback();
                        throw err;
                    }
                }
            }
        }
    } catch ( err ) {
        console.log(err)
    }
    finally {
        if(db){
            await db.close();
        }
        return {
            statusCode: 200,
            body: JSON.stringify({ surveys })
        }
    }
}


/*
module.exports.surveySync = async (context) => {
    const event = {
        "Records": [
           {
                "body": "{\n    \"cpi\": 0.8,\n    \"is_live\": true,\n    \"industry\": \"other\",\n    \"survey_id\": 39582977,\n    \"conversion\": 0.034574,\n    \"study_type\": \"adhoc\",\n    \"survey_name\": \"Other Survey\",\n    \"account_name\": \"Feedback Loop\",\n    \"collects_pii\": false,\n    \"bid_incidence\": 20,\n    \"survey_quotas\": [\n        {\n            \"questions\": [],\n            \"quota_cpi\": 0.8,\n            \"conversion\": 0.034574,\n            \"survey_quota_id\": 198265060,\n            \"survey_quota_type\": \"Total\",\n            \"number_of_respondents\": 47\n        }\n    ],\n    \"message_reason\": \"updated\",\n    \"respondent_pids\": [],\n    \"total_remaining\": 47,\n    \"country_language\": \"eng_us\",\n    \"survey_group_ids\": [],\n    \"mobile_conversion\": 0.03,\n    \"overall_completes\": 13,\n    \"earnings_per_click\": 0.02766,\n    \"survey_provider_id\": 1,\n    \"length_of_interview\": 4,\n    \"completion_percentage\": 0.216667,\n    \"survey_qualifications\": [\n        {\n            \"precodes\": [\n                \"18\",\n                \"19\",\n                \"20\",\n                \"21\",\n                \"22\",\n                \"23\",\n                \"24\",\n                \"25\",\n                \"26\",\n                \"27\",\n                \"28\",\n                \"29\",\n                \"30\",\n                \"31\",\n                \"32\",\n                \"33\",\n                \"34\",\n                \"35\",\n                \"36\",\n                \"37\",\n                \"38\",\n                \"39\",\n                \"40\",\n                \"41\",\n                \"42\",\n                \"43\",\n                \"44\",\n                \"45\",\n                \"46\",\n                \"47\",\n                \"48\",\n                \"49\",\n                \"50\",\n                \"51\",\n                \"52\",\n                \"53\",\n                \"54\",\n                \"55\",\n                \"56\",\n                \"57\",\n                \"58\",\n                \"59\",\n                \"60\",\n                \"61\",\n                \"62\",\n                \"63\",\n                \"64\",\n                \"65\",\n                \"66\",\n                \"67\",\n                \"68\",\n                \"69\",\n                \"70\",\n                \"71\",\n                \"72\",\n                \"73\",\n                \"74\",\n                \"75\"\n            ],\n            \"question_id\": 42,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"1\",\n                \"2\"\n            ],\n            \"question_id\": 43,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"1\",\n                \"10\",\n                \"11\",\n                \"12\",\n                \"13\",\n                \"14\",\n                \"15\",\n                \"16\",\n                \"2\",\n                \"3\",\n                \"4\",\n                \"5\",\n                \"6\",\n                \"7\",\n                \"8\",\n                \"9\"\n            ],\n            \"question_id\": 47,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"0\",\n                \"1\",\n                \"10\",\n                \"11\",\n                \"12\",\n                \"13\",\n                \"14\",\n                \"15\",\n                \"16\",\n                \"17\",\n                \"18\",\n                \"19\",\n                \"2\",\n                \"20\",\n                \"21\",\n                \"22\",\n                \"23\",\n                \"24\",\n                \"25\",\n                \"26\",\n                \"27\",\n                \"28\",\n                \"29\",\n                \"3\",\n                \"30\",\n                \"31\",\n                \"32\",\n                \"33\",\n                \"34\",\n                \"35\",\n                \"36\",\n                \"37\",\n                \"38\",\n                \"39\",\n                \"4\",\n                \"40\",\n                \"41\",\n                \"42\",\n                \"43\",\n                \"44\",\n                \"45\",\n                \"46\",\n                \"47\",\n                \"48\",\n                \"49\",\n                \"5\",\n                \"50\",\n                \"51\",\n                \"53\",\n                \"54\",\n                \"55\",\n                \"56\",\n                \"57\",\n                \"58\",\n                \"59\",\n                \"6\",\n                \"60\",\n                \"7\",\n                \"8\",\n                \"9\"\n            ],\n            \"question_id\": 96,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"1\",\n                \"10\",\n                \"11\",\n                \"12\",\n                \"13\",\n                \"14\",\n                \"15\",\n                \"16\",\n                \"2\",\n                \"3\",\n                \"4\",\n                \"5\",\n                \"6\",\n                \"7\",\n                \"8\",\n                \"9\"\n            ],\n            \"question_id\": 113,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"1\",\n                \"2\",\n                \"3\",\n                \"4\"\n            ],\n            \"question_id\": 122,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"1\",\n                \"10\",\n                \"11\",\n                \"12\",\n                \"2\",\n                \"3\",\n                \"4\",\n                \"5\",\n                \"6\",\n                \"7\",\n                \"8\",\n                \"9\"\n            ],\n            \"question_id\": 2189,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"false\",\n                \"true\"\n            ],\n            \"question_id\": 8214,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"-3105\",\n                \"1\",\n                \"2\",\n                \"3\",\n                \"4\",\n                \"5\"\n            ],\n            \"question_id\": 25640,\n            \"logical_operator\": \"OR\"\n        },\n        {\n            \"precodes\": [\n                \"-3105\",\n                \"1\",\n                \"10\",\n                \"11\",\n                \"12\",\n                \"13\",\n                \"14\",\n                \"15\",\n                \"16\",\n                \"17\",\n                \"18\",\n                \"19\",\n                \"2\",\n                \"20\",\n                \"21\",\n                \"22\",\n                \"23\",\n                \"24\",\n                \"3\",\n                \"4\",\n                \"5\",\n                \"6\",\n                \"7\",\n                \"8\",\n                \"9\"\n            ],\n            \"question_id\": 61076,\n            \"logical_operator\": \"OR\"\n        }\n    ],\n    \"total_client_entrants\": 376,\n    \"survey_quota_calc_type\": \"completes\",\n    \"bid_length_of_interview\": 4,\n    \"is_only_supplier_in_group\": false,\n    \"termination_length_of_interview\": 1\n}"
            },
            {
                "body": "{\"cpi\": 0.5, \"is_live\": true, \"industry\": \"other\", \"survey_id\": 39723233, \"conversion\": 0.366197, \"study_type\": \"adhoc\", \"survey_name\": \"Fun Survey! \", \"account_name\": \"Lucid Marketplace Services\", \"collects_pii\": false, \"bid_incidence\": 90, \"survey_quotas\": [{\"questions\": [], \"quota_cpi\": 0.5, \"conversion\": 0.366197, \"survey_quota_id\": 199158430, \"survey_quota_type\": \"Total\", \"number_of_respondents\": 249}], \"message_reason\": \"new\", \"respondent_pids\": [], \"total_remaining\": 249, \"country_language\": \"eng_gb\", \"survey_group_ids\": [3610912], \"mobile_conversion\": 0.34, \"overall_completes\": 26, \"earnings_per_click\": 0.183099, \"survey_provider_id\": 1, \"length_of_interview\": 7, \"completion_percentage\": 0.052104, \"survey_qualifications\": [{\"precodes\": [\"16\", \"17\", \"18\", \"19\", \"20\", \"21\", \"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\", \"30\", \"31\", \"32\", \"33\", \"34\", \"35\", \"36\", \"37\", \"38\", \"39\", \"40\", \"41\", \"42\", \"43\", \"44\", \"45\", \"46\", \"47\", \"48\", \"49\", \"50\", \"51\", \"52\", \"53\", \"54\", \"55\", \"56\", \"57\", \"58\", \"59\", \"60\", \"61\", \"62\", \"63\", \"64\", \"65\", \"66\", \"67\", \"68\", \"69\", \"70\", \"71\", \"72\", \"73\", \"74\", \"75\", \"76\", \"77\", \"78\", \"79\", \"80\", \"81\", \"82\", \"83\", \"84\", \"85\", \"86\", \"87\", \"88\", \"89\", \"90\", \"91\", \"92\", \"93\", \"94\", \"95\", \"96\", \"97\", \"98\", \"99\"], \"question_id\": 42, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\"], \"question_id\": 43, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\"], \"question_id\": 74808, \"logical_operator\": \"OR\"}, {\"precodes\": [\"2\", \"3\", \"8\", \"9\", \"11\", \"12\"], \"question_id\": 12452, \"logical_operator\": \"OR\"}], \"total_client_entrants\": 71, \"survey_quota_calc_type\": \"completes\", \"bid_length_of_interview\": 5, \"is_only_supplier_in_group\": false, \"termination_length_of_interview\": 0}"
            },
            {
                "body": "{\"cpi\": 0.7, \"is_live\": true, \"industry\": \"other\", \"survey_id\": 39724955, \"conversion\": 0.210526, \"study_type\": \"adhoc\", \"survey_name\": \"2023-08-14 ProQuo ai PIE GB project (PROD) | MY | 07:30:00\", \"account_name\": \"ProQuoAI\", \"collects_pii\": false, \"bid_incidence\": 38, \"survey_quotas\": [{\"questions\": [], \"quota_cpi\": 0.7, \"conversion\": 0.210526, \"survey_quota_id\": 199169988, \"survey_quota_type\": \"Total\", \"number_of_respondents\": 63}], \"message_reason\": \"new\", \"respondent_pids\": [], \"total_remaining\": 63, \"country_language\": \"eng_gb\", \"survey_group_ids\": [3796475], \"mobile_conversion\": 0.26, \"overall_completes\": 20, \"earnings_per_click\": 0.147368, \"survey_provider_id\": 1, \"length_of_interview\": 3, \"completion_percentage\": 0.285714, \"survey_qualifications\": [{\"precodes\": [\"18\", \"19\", \"20\", \"21\", \"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\", \"30\", \"31\", \"32\", \"33\", \"34\", \"35\", \"36\", \"37\", \"38\", \"39\"], \"question_id\": 42, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\"], \"question_id\": 43, \"logical_operator\": \"OR\"}], \"total_client_entrants\": 79, \"survey_quota_calc_type\": \"prescreens\", \"bid_length_of_interview\": 7, \"is_only_supplier_in_group\": false, \"termination_length_of_interview\": 1}"
            },
            {
                "body": "{\"cpi\": 8, \"is_live\": true, \"industry\": \"other\", \"survey_id\": 39719183, \"conversion\": 0.039773, \"study_type\": \"adhoc\", \"survey_name\": \"Other Survey\", \"account_name\": \"Quest Research Group\", \"collects_pii\": false, \"bid_incidence\": 80, \"survey_quotas\": [{\"questions\": [], \"quota_cpi\": 8, \"conversion\": 0.039773, \"survey_quota_id\": 199128253, \"survey_quota_type\": \"Total\", \"number_of_respondents\": 1143}], \"message_reason\": \"new\", \"respondent_pids\": [], \"total_remaining\": 1143, \"country_language\": \"eng_gb\", \"survey_group_ids\": [], \"mobile_conversion\": 0.04, \"overall_completes\": 7, \"earnings_per_click\": 0.318182, \"survey_provider_id\": 1, \"length_of_interview\": 14, \"completion_percentage\": 0.006087, \"survey_qualifications\": [{\"precodes\": [\"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\", \"30\", \"31\", \"32\", \"33\", \"34\", \"35\", \"36\", \"37\", \"38\", \"39\", \"40\", \"41\", \"42\", \"43\", \"44\", \"45\", \"46\", \"47\", \"48\", \"49\", \"50\", \"51\", \"52\", \"53\", \"54\", \"55\", \"56\", \"57\", \"58\", \"59\", \"60\", \"61\", \"62\", \"63\", \"64\", \"65\", \"66\", \"67\", \"68\", \"69\", \"70\", \"71\", \"72\", \"73\", \"74\", \"75\", \"76\", \"77\", \"78\", \"79\", \"80\", \"81\", \"82\", \"83\", \"84\", \"85\", \"86\", \"87\", \"88\", \"89\", \"90\", \"91\", \"92\", \"93\", \"94\", \"95\", \"96\", \"97\", \"98\", \"99\"], \"question_id\": 42, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\", \"2\"], \"question_id\": 43, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\", \"18\", \"19\", \"20\", \"21\", \"22\", \"23\", \"24\", \"-3105\"], \"question_id\": 61076, \"logical_operator\": \"OR\"}, {\"precodes\": [\"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\"], \"question_id\": 48741, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\"], \"question_id\": 2189, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\", \"2\", \"3\", \"4\"], \"question_id\": 15297, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\", \"2\"], \"question_id\": 3546, \"logical_operator\": \"OR\"}], \"total_client_entrants\": 176, \"survey_quota_calc_type\": \"completes\", \"bid_length_of_interview\": 10, \"is_only_supplier_in_group\": false, \"termination_length_of_interview\": 3}"
            },
            {
                "body": "{\"cpi\": 1, \"is_live\": true, \"industry\": \"other\", \"survey_id\": 39674701, \"conversion\": 0.108527, \"study_type\": \"adhoc\", \"survey_name\": \"Fun and interesting survey about things you buy\", \"account_name\": \"Explorer Research\", \"collects_pii\": false, \"bid_incidence\": 30, \"survey_quotas\": [{\"questions\": [], \"quota_cpi\": 1, \"conversion\": 0.108527, \"survey_quota_id\": 198841151, \"survey_quota_type\": \"Total\", \"number_of_respondents\": 1}, {\"questions\": [{\"precodes\": [\"18\", \"19\", \"20\", \"21\", \"22\", \"23\", \"24\"], \"question_id\": 42, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0, \"survey_quota_id\": 198841152, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 2}, {\"questions\": [{\"precodes\": [\"25\", \"26\", \"27\", \"28\", \"29\", \"30\", \"31\", \"32\", \"33\", \"34\"], \"question_id\": 42, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.125, \"survey_quota_id\": 198841153, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 0}, {\"questions\": [{\"precodes\": [\"35\", \"36\", \"37\", \"38\", \"39\", \"40\", \"41\", \"42\", \"43\", \"44\"], \"question_id\": 42, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.12, \"survey_quota_id\": 198841154, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 0}, {\"questions\": [{\"precodes\": [\"45\", \"46\", \"47\", \"48\", \"49\", \"50\", \"51\", \"52\", \"53\", \"54\"], \"question_id\": 42, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.2, \"survey_quota_id\": 198841155, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 0}, {\"questions\": [{\"precodes\": [\"55\", \"56\", \"57\", \"58\", \"59\", \"60\", \"61\", \"62\", \"63\", \"64\"], \"question_id\": 42, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.097561, \"survey_quota_id\": 198841156, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 0}, {\"questions\": [{\"precodes\": [\"2\"], \"question_id\": 122, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.115385, \"survey_quota_id\": 198841158, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 0}, {\"questions\": [{\"precodes\": [\"1\"], \"question_id\": 122, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.071429, \"survey_quota_id\": 198841159, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 1}, {\"questions\": [{\"precodes\": [\"3\"], \"question_id\": 122, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.084746, \"survey_quota_id\": 198841160, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 1}, {\"questions\": [{\"precodes\": [\"4\"], \"question_id\": 122, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.25, \"survey_quota_id\": 198841161, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 0}, {\"questions\": [{\"precodes\": [\"2\"], \"question_id\": 43, \"logical_operator\": \"OR\"}], \"quota_cpi\": 1, \"conversion\": 0.108527, \"survey_quota_id\": 198841408, \"survey_quota_type\": \"Client\", \"number_of_respondents\": 136}], \"message_reason\": \"new\", \"respondent_pids\": [], \"total_remaining\": 1, \"country_language\": \"eng_us\", \"survey_group_ids\": [3777617], \"mobile_conversion\": 0, \"overall_completes\": 14, \"earnings_per_click\": 0.108527, \"survey_provider_id\": 1, \"length_of_interview\": 13, \"completion_percentage\": 0.933333, \"survey_qualifications\": [{\"precodes\": [\"18\", \"19\", \"20\", \"21\", \"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\", \"30\", \"31\", \"32\", \"33\", \"34\", \"35\", \"36\", \"37\", \"38\", \"39\", \"40\", \"41\", \"42\", \"43\", \"44\", \"45\", \"46\", \"47\", \"48\", \"49\", \"50\", \"51\", \"52\", \"53\", \"54\", \"55\", \"56\", \"57\", \"58\", \"59\", \"60\", \"61\", \"62\", \"63\", \"64\"], \"question_id\": 42, \"logical_operator\": \"OR\"}, {\"precodes\": [\"2\"], \"question_id\": 43, \"logical_operator\": \"OR\"}, {\"precodes\": [\"1\", \"2\", \"3\", \"4\"], \"question_id\": 122, \"logical_operator\": \"OR\"}, {\"precodes\": [\"false\"], \"question_id\": 8214, \"logical_operator\": \"OR\"}], \"total_client_entrants\": 129, \"survey_quota_calc_type\": \"completes\", \"bid_length_of_interview\": 15, \"is_only_supplier_in_group\": false, \"termination_length_of_interview\": 1}"
            },
            {
                "body": "{\"cpi\": 2.93, \"pds\": {\"enabled\": false, \"buyer_name\": null}, \"pii\": false, \"mod_on\": 1684757807602, \"quotas\": [{\"mod_on\": 1684757807204, \"crtd_on\": 1684757807204, \"criteria\": [{\"range_sets\": [{\"to\": 60, \"from\": 25, \"units\": 311}], \"qualification_code\": 212}, {\"condition_codes\": [\"112\"], \"qualification_code\": 211}], \"quota_id\": \"90375fba-5878-4696-9bb4-3c00c3743af9\", \"quantities\": {\"achieved\": 0, \"remaining\": 50, \"currently_open\": 50}, \"last_complete_date\": null}], \"crtd_on\": 1683213731521, \"buyer_id\": 651, \"category\": \"Exciting New\", \"incl_excl\": 0, \"survey_id\": 15443937, \"price_type\": 1, \"soft_launch\": false, \"survey_name\": \"Exciting New Survey #15443937\", \"channel_type\": null, \"buyer_message\": \"\", \"category_code\": 232, \"link_security\": 2, \"survey_status\": 22, \"field_end_date\": 1685535407000, \"qualifications\": [{\"condition_codes\": [\"112\"], \"qualification_code\": 211}, {\"range_sets\": [{\"to\": 60, \"from\": 25, \"units\": 311}], \"qualification_code\": 212}], \"click_balancing\": 0, \"survey_grouping\": {}, \"last_complete_date\": null, \"supplier_completes\": {\"needed\": 50, \"achieved\": 0, \"remaining\": 50, \"guaranteed_allocation\": 0, \"guaranteed_allocation_remaining\": 0}, \"surveyLocalization\": \"en_US\", \"survey_performance\": {\"overall\": {\"ir\": 25, \"loi\": 10}, \"last_block\": {\"ir\": null, \"bdp\": null, \"btp\": null, \"epc\": null, \"loi\": null, \"oqp\": null, \"ppm\": null, \"acpi\": null, \"bqtp\": null, \"bstp\": null}}, \"survey_provider_id\": \"3\", \"project_last_complete_date\": null}"
            },
            {
                "body": "{\"cpi\": 3.51, \"pds\": {\"enabled\": false, \"buyer_name\": null}, \"pii\": false, \"mod_on\": 1685476143941, \"quotas\": [{\"mod_on\": 1684763514422, \"crtd_on\": 1684763514422, \"criteria\": [{\"range_sets\": [{\"to\": 64, \"from\": 35, \"units\": 311}], \"qualification_code\": 212}, {\"condition_codes\": [\"112\", \"111\"], \"qualification_code\": 211}, {\"condition_codes\": [\"8001\", \"8002\", \"8003\", \"8004\", \"8007\", \"8009\", \"8010\", \"8011\", \"8012\", \"8014\", \"8015\", \"8016\", \"8018\", \"8019\", \"8020\", \"8021\", \"8022\", \"8023\", \"8025\", \"8026\", \"8027\", \"8028\", \"8029\", \"8030\", \"8031\", \"8032\", \"8033\", \"8034\", \"8035\", \"8036\", \"8038\", \"8039\", \"8041\", \"8042\", \"8043\", \"8045\", \"8046\", \"8048\", \"8049\", \"8051\", \"8052\", \"8053\", \"8054\", \"8055\", \"8056\", \"8057\", \"8059\", \"8060\", \"8061\", \"8062\", \"8063\", \"8064\", \"8065\", \"8066\", \"8067\", \"8068\", \"8069\", \"8070\", \"8071\", \"8072\", \"8073\", \"8074\", \"8075\", \"8076\", \"8077\", \"8078\", \"8079\", \"8080\", \"8081\", \"8083\", \"8084\", \"8085\", \"8086\", \"8088\", \"8089\", \"8090\", \"8091\", \"8093\", \"8094\", \"8095\", \"8096\", \"8097\", \"8098\", \"8099\", \"8101\", \"8102\", \"8103\", \"8104\", \"8105\", \"8106\", \"8107\", \"8108\", \"8109\", \"8110\", \"8224\", \"8312\", \"8318\", \"8322\", \"8328\", \"8343\", \"8344\", \"8347\", \"8505\", \"8511\", \"8515\", \"8518\", \"8520\", \"8525\", \"8534\", \"8540\", \"8541\", \"8542\", \"8543\", \"8544\", \"8550\", \"8554\", \"8560\", \"8561\", \"8562\", \"8601\", \"8602\", \"8603\", \"8604\", \"8605\", \"8606\", \"8607\", \"8608\", \"8609\", \"8610\", \"8611\", \"8618\", \"8619\", \"8620\", \"8625\", \"8628\", \"8629\", \"8638\", \"8640\", \"8641\", \"8645\", \"8646\", \"8647\", \"8648\", \"8650\", \"8666\", \"8690\", \"8691\", \"8695\", \"12010\", \"12016\", \"12066\", \"12068\", \"12069\", \"12070\", \"12072\", \"12086\", \"12166\", \"12167\", \"12177\", \"12406\", \"12421\", \"12430\", \"12434\", \"12438\", \"12455\", \"12459\", \"12474\", \"13317\", \"13339\", \"13410\", \"13428\", \"13452\", \"13731\", \"13739\", \"13740\", \"13750\", \"13751\", \"13752\", \"13753\", \"13755\", \"13756\", \"13757\", \"13774\", \"13775\", \"13782\", \"13783\", \"13786\", \"13788\", \"13804\", \"13806\", \"13838\", \"13839\", \"13842\", \"13846\", \"13847\", \"13856\", \"13860\", \"16113\", \"16114\", \"16121\", \"16124\", \"16125\", \"16127\", \"16130\", \"16133\", \"16134\", \"16137\", \"16145\", \"16146\", \"16148\", \"16150\", \"16151\", \"16153\", \"16154\", \"16159\", \"16161\", \"16311\", \"18039\", \"18041\", \"18054\", \"18070\", \"18073\", \"18074\", \"18076\", \"18077\", \"18081\", \"18084\", \"18901\", \"18902\", \"18910\", \"18911\", \"18912\", \"18913\", \"18914\", \"18915\", \"18916\", \"18917\", \"18918\", \"18920\", \"18921\", \"18922\", \"18923\", \"18925\", \"18927\", \"18928\", \"18929\", \"18930\", \"18931\", \"18932\", \"18933\", \"18934\", \"18935\", \"18936\", \"18938\", \"18940\", \"18942\", \"18943\", \"18944\", \"18946\", \"18947\", \"18949\", \"18950\", \"18951\", \"18953\", \"18954\", \"18955\", \"18956\", \"18957\", \"18958\", \"18960\", \"18962\", \"18963\", \"18964\", \"18966\", \"18968\", \"18969\", \"18970\", \"18971\", \"18972\", \"18974\", \"18976\", \"18977\", \"18979\", \"18980\", \"18981\", \"18991\", \"19001\", \"19002\", \"19003\", \"19004\", \"19006\", \"19007\", \"19008\", \"19009\", \"19010\", \"19012\", \"19013\", \"19014\", \"19015\", \"19016\", \"19017\", \"19018\", \"19019\", \"19020\", \"19021\", \"19022\", \"19023\", \"19025\", \"19026\", \"19027\", \"19028\", \"19029\", \"19030\", \"19031\", \"19032\", \"19033\", \"19034\", \"19035\", \"19036\", \"19037\", \"19038\", \"19039\", \"19040\", \"19041\", \"19043\", \"19044\", \"19046\", \"19047\", \"19048\", \"19049\", \"19050\", \"19052\", \"19053\", \"19054\", \"19055\", \"19056\", \"19057\", \"19058\", \"19060\", \"19061\", \"19063\", \"19064\", \"19065\", \"19066\", \"19067\", \"19070\", \"19072\", \"19073\", \"19074\", \"19075\", \"19076\", \"19078\", \"19079\", \"19081\", \"19082\", \"19083\", \"19085\", \"19086\", \"19087\", \"19090\", \"19091\", \"19092\", \"19093\", \"19094\", \"19095\", \"19096\", \"19098\", \"19099\", \"19101\", \"19102\", \"19103\", \"19104\", \"19105\", \"19106\", \"19107\", \"19108\", \"19109\", \"19110\", \"19111\", \"19112\", \"19113\", \"19114\", \"19115\", \"19116\", \"19118\", \"19119\", \"19120\", \"19121\", \"19122\", \"19123\", \"19124\", \"19125\", \"19126\", \"19127\", \"19128\", \"19129\", \"19130\", \"19131\", \"19132\", \"19133\", \"19134\", \"19135\", \"19136\", \"19137\", \"19138\", \"19139\", \"19140\", \"19141\", \"19142\", \"19143\", \"19144\", \"19145\", \"19146\", \"19147\", \"19148\", \"19149\", \"19150\", \"19151\", \"19152\", \"19153\", \"19154\", \"19155\", \"19160\", \"19161\", \"19162\", \"19170\", \"19171\", \"19172\", \"19173\", \"19175\", \"19176\", \"19177\", \"19178\", \"19179\", \"19181\", \"19182\", \"19183\", \"19184\", \"19185\", \"19187\", \"19188\", \"19190\", \"19191\", \"19192\", \"19193\", \"19194\", \"19195\", \"19196\", \"19197\", \"19244\", \"19255\", \"19301\", \"19310\", \"19311\", \"19312\", \"19316\", \"19317\", \"19318\", \"19319\", \"19320\", \"19330\", \"19331\", \"19333\", \"19335\", \"19339\", \"19340\", \"19341\", \"19342\", \"19343\", \"19344\", \"19345\", \"19346\", \"19347\", \"19348\", \"19350\", \"19351\", \"19352\", \"19353\", \"19354\", \"19355\", \"19357\", \"19358\", \"19360\", \"19362\", \"19363\", \"19365\", \"19366\", \"19367\", \"19369\", \"19371\", \"19372\", \"19373\", \"19374\", \"19375\", \"19376\", \"19380\", \"19381\", \"19382\", \"19383\", \"19390\", \"19395\", \"19397\", \"19398\", \"19399\", \"19401\", \"19403\", \"19404\", \"19405\", \"19406\", \"19407\", \"19408\", \"19409\", \"19415\", \"19421\", \"19422\", \"19423\", \"19424\", \"19425\", \"19426\", \"19428\", \"19429\", \"19430\", \"19432\", \"19435\", \"19436\", \"19437\", \"19438\", \"19440\", \"19441\", \"19442\", \"19443\", \"19444\", \"19446\", \"19450\", \"19451\", \"19453\", \"19454\", \"19455\", \"19456\", \"19457\", \"19460\", \"19462\", \"19464\", \"19465\", \"19468\", \"19470\", \"19472\", \"19473\", \"19474\", \"19475\", \"19477\", \"19478\", \"19480\", \"19481\", \"19482\", \"19484\", \"19486\", \"19490\", \"19492\", \"19493\", \"19494\", \"19495\", \"19496\", \"19520\", \"19525\", \"20810\", \"20811\", \"20812\", \"20813\", \"20814\", \"20815\", \"20816\", \"20817\", \"20818\", \"20824\", \"20825\", \"20827\", \"20830\", \"20832\", \"20833\", \"20837\", \"20838\", \"20839\", \"20841\", \"20842\", \"20847\", \"20848\", \"20849\", \"20850\", \"20851\", \"20852\", \"20853\", \"20854\", \"20855\", \"20857\", \"20859\", \"20860\", \"20861\", \"20862\", \"20866\", \"20868\", \"20871\", \"20872\", \"20874\", \"20875\", \"20876\", \"20877\", \"20878\", \"20879\", \"20880\", \"20882\", \"20883\", \"20884\", \"20885\", \"20886\", \"20889\", \"20891\", \"20892\", \"20894\", \"20895\", \"20896\", \"20897\", \"20898\", \"20899\", \"20901\", \"20902\", \"20903\", \"20904\", \"20905\", \"20906\", \"20907\", \"20908\", \"20910\", \"20911\", \"20912\", \"20913\", \"20914\", \"20915\", \"20916\", \"20918\", \"20993\", \"20997\", \"23001\", \"23003\", \"23018\", \"23050\", \"23061\", \"23062\", \"23072\", \"23107\", \"23131\", \"23154\", \"23155\", \"23178\", \"23183\", \"23184\", \"23190\", \"24060\", \"24061\", \"24062\", \"24063\", \"24068\", \"24073\", \"24087\", \"24111\", \"24138\", \"24149\", \"24153\", \"24155\", \"24157\", \"24162\", \"24701\", \"24712\", \"24714\", \"24715\", \"24724\", \"24729\", \"24731\", \"24732\", \"24733\", \"24736\", \"24737\", \"24738\", \"24739\", \"24740\", \"24747\", \"24751\", \"25820\", \"25841\", \"25922\", \"25971\", \"27209\", \"27229\", \"27247\", \"27306\", \"27356\", \"27371\", \"27921\", \"27974\", \"27976\", \"29014\", \"29055\", \"29706\", \"29712\", \"29714\", \"29724\", \"29729\", \"30410\", \"30412\", \"30445\", \"30470\", \"30473\", \"31547\", \"31548\", \"31558\", \"31565\", \"31568\", \"31569\", \"36013\", \"36036\", \"36043\", \"36046\", \"36052\", \"36057\", \"36064\", \"36065\", \"36069\", \"36101\", \"36102\", \"36103\", \"36104\", \"36105\", \"36106\", \"36107\", \"36108\", \"36109\", \"36110\", \"36111\", \"36112\", \"36113\", \"36114\", \"36115\", \"36116\", \"36117\", \"36118\", \"36119\", \"36120\", \"36121\", \"36123\", \"36124\", \"36125\", \"36130\", \"36131\", \"36132\", \"36135\", \"36140\", \"36141\", \"36142\", \"36177\", \"36191\", \"37040\", \"37041\", \"37042\", \"37043\", \"37044\", \"37052\", \"37142\", \"37171\", \"37191\", \"38332\", \"38340\", \"38347\", \"38352\", \"38925\", \"38967\", \"39747\", \"39767\", \"40310\", \"40330\", \"40337\", \"40353\", \"40372\", \"43003\", \"43015\", \"43021\", \"43032\", \"43035\", \"43061\", \"43065\", \"43066\", \"43074\", \"43082\", \"43240\", \"45309\", \"45310\", \"45315\", \"45322\", \"45325\", \"45327\", \"45342\", \"45343\", \"45345\", \"45354\", \"45377\", \"45401\", \"45402\", \"45403\", \"45404\", \"45405\", \"45406\", \"45409\", \"45410\", \"45412\", \"45413\", \"45414\", \"45415\", \"45416\", \"45417\", \"45419\", \"45420\", \"45422\", \"45423\", \"45424\", \"45426\", \"45428\", \"45429\", \"45430\", \"45437\", \"45439\", \"45440\", \"45441\", \"45448\", \"45449\", \"45458\", \"45459\", \"45469\", \"45470\", \"45475\", \"45479\", \"45481\", \"45482\", \"45490\", \"45822\", \"45826\", \"45828\", \"45846\", \"45860\", \"45862\", \"45866\", \"45882\", \"45883\", \"47302\", \"47303\", \"47304\", \"47305\", \"47306\", \"47307\", \"47308\", \"47320\", \"47334\", \"47338\", \"47342\", \"47367\", \"47383\", \"47396\", \"47916\", \"47933\", \"47940\", \"47954\", \"47955\", \"47965\", \"47967\", \"47968\", \"47989\", \"47990\", \"47994\", \"50654\", \"50847\", \"50864\", \"51532\", \"51566\", \"51573\", \"51591\", \"52035\", \"52036\", \"52038\", \"52041\", \"52050\", \"52057\", \"52223\", \"52237\", \"52330\", \"58523\", \"58541\", \"58545\", \"58571\", \"58580\", \"61231\", \"61260\", \"61263\", \"61272\", \"61276\", \"61281\", \"61412\", \"61442\", \"61465\", \"61466\", \"61476\", \"61486\", \"62015\", \"62017\", \"62019\", \"62032\", \"62049\", \"62051\", \"62056\", \"62075\", \"62076\", \"62077\", \"62089\", \"62091\", \"62094\", \"62533\", \"62538\", \"62560\", \"62572\", \"63333\", \"63350\", \"63351\", \"63359\", \"63361\", \"63363\", \"63384\", \"64661\", \"64673\", \"65020\", \"65049\", \"65052\", \"65065\", \"65069\", \"65079\", \"65324\", \"65591\", \"65786\", \"65787\", \"67301\", \"67333\", \"67335\", \"67337\", \"67340\", \"67344\", \"67347\", \"67351\", \"67363\", \"67364\", \"71935\", \"71957\", \"71960\", \"71961\", \"71965\", \"71966\", \"71969\", \"71970\", \"74338\", \"74342\", \"74344\", \"74345\", \"74346\", \"74347\", \"74359\", \"74368\", \"77301\", \"77302\", \"77303\", \"77304\", \"77305\", \"77306\", \"77316\", \"77318\", \"77333\", \"77353\", \"77354\", \"77355\", \"77356\", \"77357\", \"77362\", \"77365\", \"77372\", \"77378\", \"77380\", \"77381\", \"77382\", \"77384\", \"77385\", \"77386\", \"77387\", \"77393\"], \"qualification_code\": 229}, {\"condition_codes\": [\"112\", \"113\", \"115\", \"116\", \"111\", \"114\"], \"qualification_code\": 216}], \"quota_id\": \"f1fe6488-eea2-4053-b5c1-bd9cce1823fd\", \"quantities\": {\"achieved\": 0, \"remaining\": 100, \"currently_open\": 100}, \"last_complete_date\": null}], \"crtd_on\": 1684763514365, \"buyer_id\": 651, \"category\": \"Exciting New\", \"incl_excl\": 0, \"survey_id\": 15858624, \"price_type\": 1, \"soft_launch\": false, \"survey_name\": \"Exciting New Survey #15858624\", \"channel_type\": null, \"buyer_message\": \"\", \"category_code\": 232, \"link_security\": 2, \"survey_status\": 22, \"field_end_date\": 1686512943000, \"qualifications\": [{\"condition_codes\": [\"112\", \"111\"], \"qualification_code\": 211}, {\"range_sets\": [{\"to\": 64, \"from\": 35, \"units\": 311}], \"qualification_code\": 212}, {\"condition_codes\": [\"115\", \"113\", \"111\", \"112\", \"116\", \"114\"], \"qualification_code\": 216}, {\"condition_codes\": [\"8001\", \"8002\", \"8003\", \"8004\", \"8007\", \"8009\", \"8010\", \"8011\", \"8012\", \"8014\", \"8015\", \"8016\", \"8018\", \"8019\", \"8020\", \"8021\", \"8022\", \"8023\", \"8025\", \"8026\", \"8027\", \"8028\", \"8029\", \"8030\", \"8031\", \"8032\", \"8033\", \"8034\", \"8035\", \"8036\", \"8038\", \"8039\", \"8041\", \"8042\", \"8043\", \"8045\", \"8046\", \"8048\", \"8049\", \"8051\", \"8052\", \"8053\", \"8054\", \"8055\", \"8056\", \"8057\", \"8059\", \"8060\", \"8061\", \"8062\", \"8063\", \"8064\", \"8065\", \"8066\", \"8067\", \"8068\", \"8069\", \"8070\", \"8071\", \"8072\", \"8073\", \"8074\", \"8075\", \"8076\", \"8077\", \"8078\", \"8079\", \"8080\", \"8081\", \"8083\", \"8084\", \"8085\", \"8086\", \"8088\", \"8089\", \"8090\", \"8091\", \"8093\", \"8094\", \"8095\", \"8096\", \"8097\", \"8098\", \"8099\", \"8101\", \"8102\", \"8103\", \"8104\", \"8105\", \"8106\", \"8107\", \"8108\", \"8109\", \"8110\", \"8224\", \"8312\", \"8318\", \"8322\", \"8328\", \"8343\", \"8344\", \"8347\", \"8505\", \"8511\", \"8515\", \"8518\", \"8520\", \"8525\", \"8534\", \"8540\", \"8541\", \"8542\", \"8543\", \"8544\", \"8550\", \"8554\", \"8560\", \"8561\", \"8562\", \"8601\", \"8602\", \"8603\", \"8604\", \"8605\", \"8606\", \"8607\", \"8608\", \"8609\", \"8610\", \"8611\", \"8618\", \"8619\", \"8620\", \"8625\", \"8628\", \"8629\", \"8638\", \"8640\", \"8641\", \"8645\", \"8646\", \"8647\", \"8648\", \"8650\", \"8666\", \"8690\", \"8691\", \"8695\", \"12010\", \"12016\", \"12066\", \"12068\", \"12069\", \"12070\", \"12072\", \"12086\", \"12166\", \"12167\", \"12177\", \"12406\", \"12421\", \"12430\", \"12434\", \"12438\", \"12455\", \"12459\", \"12474\", \"13317\", \"13339\", \"13410\", \"13428\", \"13452\", \"13731\", \"13739\", \"13740\", \"13750\", \"13751\", \"13752\", \"13753\", \"13755\", \"13756\", \"13757\", \"13774\", \"13775\", \"13782\", \"13783\", \"13786\", \"13788\", \"13804\", \"13806\", \"13838\", \"13839\", \"13842\", \"13846\", \"13847\", \"13856\", \"13860\", \"16113\", \"16114\", \"16121\", \"16124\", \"16125\", \"16127\", \"16130\", \"16133\", \"16134\", \"16137\", \"16145\", \"16146\", \"16148\", \"16150\", \"16151\", \"16153\", \"16154\", \"16159\", \"16161\", \"16311\", \"18039\", \"18041\", \"18054\", \"18070\", \"18073\", \"18074\", \"18076\", \"18077\", \"18081\", \"18084\", \"18901\", \"18902\", \"18910\", \"18911\", \"18912\", \"18913\", \"18914\", \"18915\", \"18916\", \"18917\", \"18918\", \"18920\", \"18921\", \"18922\", \"18923\", \"18925\", \"18927\", \"18928\", \"18929\", \"18930\", \"18931\", \"18932\", \"18933\", \"18934\", \"18935\", \"18936\", \"18938\", \"18940\", \"18942\", \"18943\", \"18944\", \"18946\", \"18947\", \"18949\", \"18950\", \"18951\", \"18953\", \"18954\", \"18955\", \"18956\", \"18957\", \"18958\", \"18960\", \"18962\", \"18963\", \"18964\", \"18966\", \"18968\", \"18969\", \"18970\", \"18971\", \"18972\", \"18974\", \"18976\", \"18977\", \"18979\", \"18980\", \"18981\", \"18991\", \"19001\", \"19002\", \"19003\", \"19004\", \"19006\", \"19007\", \"19008\", \"19009\", \"19010\", \"19012\", \"19013\", \"19014\", \"19015\", \"19016\", \"19017\", \"19018\", \"19019\", \"19020\", \"19021\", \"19022\", \"19023\", \"19025\", \"19026\", \"19027\", \"19028\", \"19029\", \"19030\", \"19031\", \"19032\", \"19033\", \"19034\", \"19035\", \"19036\", \"19037\", \"19038\", \"19039\", \"19040\", \"19041\", \"19043\", \"19044\", \"19046\", \"19047\", \"19048\", \"19049\", \"19050\", \"19052\", \"19053\", \"19054\", \"19055\", \"19056\", \"19057\", \"19058\", \"19060\", \"19061\", \"19063\", \"19064\", \"19065\", \"19066\", \"19067\", \"19070\", \"19072\", \"19073\", \"19074\", \"19075\", \"19076\", \"19078\", \"19079\", \"19081\", \"19082\", \"19083\", \"19085\", \"19086\", \"19087\", \"19090\", \"19091\", \"19092\", \"19093\", \"19094\", \"19095\", \"19096\", \"19098\", \"19099\", \"19101\", \"19102\", \"19103\", \"19104\", \"19105\", \"19106\", \"19107\", \"19108\", \"19109\", \"19110\", \"19111\", \"19112\", \"19113\", \"19114\", \"19115\", \"19116\", \"19118\", \"19119\", \"19120\", \"19121\", \"19122\", \"19123\", \"19124\", \"19125\", \"19126\", \"19127\", \"19128\", \"19129\", \"19130\", \"19131\", \"19132\", \"19133\", \"19134\", \"19135\", \"19136\", \"19137\", \"19138\", \"19139\", \"19140\", \"19141\", \"19142\", \"19143\", \"19144\", \"19145\", \"19146\", \"19147\", \"19148\", \"19149\", \"19150\", \"19151\", \"19152\", \"19153\", \"19154\", \"19155\", \"19160\", \"19161\", \"19162\", \"19170\", \"19171\", \"19172\", \"19173\", \"19175\", \"19176\", \"19177\", \"19178\", \"19179\", \"19181\", \"19182\", \"19183\", \"19184\", \"19185\", \"19187\", \"19188\", \"19190\", \"19191\", \"19192\", \"19193\", \"19194\", \"19195\", \"19196\", \"19197\", \"19244\", \"19255\", \"19301\", \"19310\", \"19311\", \"19312\", \"19316\", \"19317\", \"19318\", \"19319\", \"19320\", \"19330\", \"19331\", \"19333\", \"19335\", \"19339\", \"19340\", \"19341\", \"19342\", \"19343\", \"19344\", \"19345\", \"19346\", \"19347\", \"19348\", \"19350\", \"19351\", \"19352\", \"19353\", \"19354\", \"19355\", \"19357\", \"19358\", \"19360\", \"19362\", \"19363\", \"19365\", \"19366\", \"19367\", \"19369\", \"19371\", \"19372\", \"19373\", \"19374\", \"19375\", \"19376\", \"19380\", \"19381\", \"19382\", \"19383\", \"19390\", \"19395\", \"19397\", \"19398\", \"19399\", \"19401\", \"19403\", \"19404\", \"19405\", \"19406\", \"19407\", \"19408\", \"19409\", \"19415\", \"19421\", \"19422\", \"19423\", \"19424\", \"19425\", \"19426\", \"19428\", \"19429\", \"19430\", \"19432\", \"19435\", \"19436\", \"19437\", \"19438\", \"19440\", \"19441\", \"19442\", \"19443\", \"19444\", \"19446\", \"19450\", \"19451\", \"19453\", \"19454\", \"19455\", \"19456\", \"19457\", \"19460\", \"19462\", \"19464\", \"19465\", \"19468\", \"19470\", \"19472\", \"19473\", \"19474\", \"19475\", \"19477\", \"19478\", \"19480\", \"19481\", \"19482\", \"19484\", \"19486\", \"19490\", \"19492\", \"19493\", \"19494\", \"19495\", \"19496\", \"19520\", \"19525\", \"20810\", \"20811\", \"20812\", \"20813\", \"20814\", \"20815\", \"20816\", \"20817\", \"20818\", \"20824\", \"20825\", \"20827\", \"20830\", \"20832\", \"20833\", \"20837\", \"20838\", \"20839\", \"20841\", \"20842\", \"20847\", \"20848\", \"20849\", \"20850\", \"20851\", \"20852\", \"20853\", \"20854\", \"20855\", \"20857\", \"20859\", \"20860\", \"20861\", \"20862\", \"20866\", \"20868\", \"20871\", \"20872\", \"20874\", \"20875\", \"20876\", \"20877\", \"20878\", \"20879\", \"20880\", \"20882\", \"20883\", \"20884\", \"20885\", \"20886\", \"20889\", \"20891\", \"20892\", \"20894\", \"20895\", \"20896\", \"20897\", \"20898\", \"20899\", \"20901\", \"20902\", \"20903\", \"20904\", \"20905\", \"20906\", \"20907\", \"20908\", \"20910\", \"20911\", \"20912\", \"20913\", \"20914\", \"20915\", \"20916\", \"20918\", \"20993\", \"20997\", \"23001\", \"23003\", \"23018\", \"23050\", \"23061\", \"23062\", \"23072\", \"23107\", \"23131\", \"23154\", \"23155\", \"23178\", \"23183\", \"23184\", \"23190\", \"24060\", \"24061\", \"24062\", \"24063\", \"24068\", \"24073\", \"24087\", \"24111\", \"24138\", \"24149\", \"24153\", \"24155\", \"24157\", \"24162\", \"24701\", \"24712\", \"24714\", \"24715\", \"24724\", \"24729\", \"24731\", \"24732\", \"24733\", \"24736\", \"24737\", \"24738\", \"24739\", \"24740\", \"24747\", \"24751\", \"25820\", \"25841\", \"25922\", \"25971\", \"27209\", \"27229\", \"27247\", \"27306\", \"27356\", \"27371\", \"27921\", \"27974\", \"27976\", \"29014\", \"29055\", \"29706\", \"29712\", \"29714\", \"29724\", \"29729\", \"30410\", \"30412\", \"30445\", \"30470\", \"30473\", \"31547\", \"31548\", \"31558\", \"31565\", \"31568\", \"31569\", \"36013\", \"36036\", \"36043\", \"36046\", \"36052\", \"36057\", \"36064\", \"36065\", \"36069\", \"36101\", \"36102\", \"36103\", \"36104\", \"36105\", \"36106\", \"36107\", \"36108\", \"36109\", \"36110\", \"36111\", \"36112\", \"36113\", \"36114\", \"36115\", \"36116\", \"36117\", \"36118\", \"36119\", \"36120\", \"36121\", \"36123\", \"36124\", \"36125\", \"36130\", \"36131\", \"36132\", \"36135\", \"36140\", \"36141\", \"36142\", \"36177\", \"36191\", \"37040\", \"37041\", \"37042\", \"37043\", \"37044\", \"37052\", \"37142\", \"37171\", \"37191\", \"38332\", \"38340\", \"38347\", \"38352\", \"38925\", \"38967\", \"39747\", \"39767\", \"40310\", \"40330\", \"40337\", \"40353\", \"40372\", \"43003\", \"43015\", \"43021\", \"43032\", \"43035\", \"43061\", \"43065\", \"43066\", \"43074\", \"43082\", \"43240\", \"45309\", \"45310\", \"45315\", \"45322\", \"45325\", \"45327\", \"45342\", \"45343\", \"45345\", \"45354\", \"45377\", \"45401\", \"45402\", \"45403\", \"45404\", \"45405\", \"45406\", \"45409\", \"45410\", \"45412\", \"45413\", \"45414\", \"45415\", \"45416\", \"45417\", \"45419\", \"45420\", \"45422\", \"45423\", \"45424\", \"45426\", \"45428\", \"45429\", \"45430\", \"45437\", \"45439\", \"45440\", \"45441\", \"45448\", \"45449\", \"45458\", \"45459\", \"45469\", \"45470\", \"45475\", \"45479\", \"45481\", \"45482\", \"45490\", \"45822\", \"45826\", \"45828\", \"45846\", \"45860\", \"45862\", \"45866\", \"45882\", \"45883\", \"47302\", \"47303\", \"47304\", \"47305\", \"47306\", \"47307\", \"47308\", \"47320\", \"47334\", \"47338\", \"47342\", \"47367\", \"47383\", \"47396\", \"47916\", \"47933\", \"47940\", \"47954\", \"47955\", \"47965\", \"47967\", \"47968\", \"47989\", \"47990\", \"47994\", \"50654\", \"50847\", \"50864\", \"51532\", \"51566\", \"51573\", \"51591\", \"52035\", \"52036\", \"52038\", \"52041\", \"52050\", \"52057\", \"52223\", \"52237\", \"52330\", \"58523\", \"58541\", \"58545\", \"58571\", \"58580\", \"61231\", \"61260\", \"61263\", \"61272\", \"61276\", \"61281\", \"61412\", \"61442\", \"61465\", \"61466\", \"61476\", \"61486\", \"62015\", \"62017\", \"62019\", \"62032\", \"62049\", \"62051\", \"62056\", \"62075\", \"62076\", \"62077\", \"62089\", \"62091\", \"62094\", \"62533\", \"62538\", \"62560\", \"62572\", \"63333\", \"63350\", \"63351\", \"63359\", \"63361\", \"63363\", \"63384\", \"64661\", \"64673\", \"65020\", \"65049\", \"65052\", \"65065\", \"65069\", \"65079\", \"65324\", \"65591\", \"65786\", \"65787\", \"67301\", \"67333\", \"67335\", \"67337\", \"67340\", \"67344\", \"67347\", \"67351\", \"67363\", \"67364\", \"71935\", \"71957\", \"71960\", \"71961\", \"71965\", \"71966\", \"71969\", \"71970\", \"74338\", \"74342\", \"74344\", \"74345\", \"74346\", \"74347\", \"74359\", \"74368\", \"77301\", \"77302\", \"77303\", \"77304\", \"77305\", \"77306\", \"77316\", \"77318\", \"77333\", \"77353\", \"77354\", \"77355\", \"77356\", \"77357\", \"77362\", \"77365\", \"77372\", \"77378\", \"77380\", \"77381\", \"77382\", \"77384\", \"77385\", \"77386\", \"77387\", \"77393\"], \"qualification_code\": 229}], \"click_balancing\": 0, \"survey_grouping\": {}, \"last_complete_date\": null, \"supplier_completes\": {\"needed\": 100, \"achieved\": 0, \"remaining\": 100, \"guaranteed_allocation\": 0, \"guaranteed_allocation_remaining\": 0}, \"surveyLocalization\": \"en_US\", \"survey_performance\": {\"overall\": {\"ir\": 25, \"loi\": 15}, \"last_block\": {\"ir\": null, \"bdp\": null, \"btp\": null, \"epc\": null, \"loi\": null, \"oqp\": null, \"ppm\": null, \"acpi\": null, \"bqtp\": null, \"bstp\": null}}, \"survey_provider_id\": \"3\", \"project_last_complete_date\": null}"
            },
            {
                "body": "{\n   \"cpi\":0.64,\n   \"pds\":{\n      \"enabled\":false,\n      \"buyer_name\":null\n   },\n   \"pii\":false,\n   \"mod_on\":1685481064642,\n   \"quotas\":[\n      {\n         \"mod_on\":1685469951366,\n         \"crtd_on\":1685469951366,\n         \"criteria\":[\n            {\n               \"condition_codes\":[\n                  \"20\"\n               ],\n               \"qualification_code\":225\n            },\n            {\n               \"condition_codes\":[\n                  \"111\",\n                  \"112\"\n               ],\n               \"qualification_code\":211\n            },\n            {\n               \"range_sets\":[\n                  {\n                     \"to\":60,\n                     \"from\":16,\n                     \"units\":311\n                  }\n               ],\n               \"qualification_code\":212\n            }\n         ],\n         \"quota_id\":\"5709f07c-5e0d-4292-b602-ca23905e6261\",\n         \"quantities\":{\n            \"achieved\":0,\n            \"remaining\":79,\n            \"currently_open\":1\n         },\n         \"last_complete_date\":null\n      }\n   ],\n   \"crtd_on\":1685450459190,\n   \"buyer_id\":651,\n   \"category\":\"Exciting New\",\n   \"incl_excl\":0,\n   \"survey_id\":16070510,\n   \"price_type\":1,\n   \"soft_launch\":false,\n   \"survey_name\":\"Exciting New Survey #16070510\",\n   \"channel_type\":null,\n   \"buyer_message\":\"\",\n   \"category_code\":232,\n   \"link_security\":2,\n   \"survey_status\":22,\n   \"field_end_date\":1686604264000,\n   \"qualifications\":[\n      {\n         \"condition_codes\":[\n            \"111\",\n            \"112\"\n         ],\n         \"qualification_code\":211\n      },\n      {\n         \"range_sets\":[\n            {\n               \"to\":30,\n               \"from\":16,\n               \"units\":311\n            }\n         ],\n         \"qualification_code\":212\n      },\n      {\n         \"condition_codes\":[],\n         \"qualification_code\":229\n      }\n   ],\n   \"click_balancing\":0,\n   \"survey_grouping\":{\n      \n   },\n   \"last_complete_date\":null,\n   \"supplier_completes\":{\n      \"needed\":1,\n      \"achieved\":0,\n      \"remaining\":1,\n      \"guaranteed_allocation\":0,\n      \"guaranteed_allocation_remaining\":0\n   },\n   \"surveyLocalization\":\"en_GB\",\n   \"survey_performance\":{\n      \"overall\":{\n         \"ir\":80,\n         \"loi\":10\n      },\n      \"last_block\":{\n         \"ir\":null,\n         \"bdp\":null,\n         \"btp\":null,\n         \"epc\":null,\n         \"loi\":null,\n         \"oqp\":null,\n         \"ppm\":null,\n         \"acpi\":null,\n         \"bqtp\":null,\n         \"bstp\":null\n      }\n   },\n   \"survey_provider_id\":\"3\",\n   \"project_last_complete_date\":null\n}"
            },
            {
                "body":"{\"IR\":2,\"CPI\":0.57,\"LOI\":13,\"LiveLink\":\"https://surveys.sample-cube.com?VID=21092&SID=CAA0FE0B-D7D2-4B0E-B9A6-CD576D0A370D&LID=1&pid=[#scid#]&uid=[#scid2#]&zid=[#scid3#]\",\"SurveyId\":17987498,\"AccountId\":1,\"UrlTypeId\":0,\"CollectPII\":false,\"IndustryId\":30,\"LanguageId\":1,\"IsManualInc\":false,\"StudyTypeId\":1,\"BillingEntityId\":2,\"IsMobileAllowed\":true,\"IsQuotaLevelCPI\":false,\"IsTabletAllowed\":true,\"UpdateTimeStamp\":\"2023-08-08T05:49:17.8341736\",\"IsNonMobileAllowed\":true,\"IsSurveyGroupExist\":true,\"Qual_UpdateTimeStamp\":\"2023-08-08T05:49:17.96\",\"Group_UpdateTimeStamp\":\"2023-08-07T05:19:15.067\",\"Quota_UpdateTimeStamp\":\"2023-08-08T05:49:18.153\",\"survey_provider_id\":4,\"qualifications\":[{\"QualificationId\":7054,\"UpdateTimeStamp\":\"2023-07-31T16:46:57.833\",\"AnswerIds\":[\"148547\"],\"AnswerCodes\":[\"4\"]},{\"QualificationId\":59,\"UpdateTimeStamp\":\"2023-08-07T05:19:11.363\",\"AnswerIds\":[\"18-49\"],\"AnswerCodes\":[\"1\"]},{\"QualificationId\":60,\"UpdateTimeStamp\":\"2023-08-08T06:52:03.597\",\"AnswerIds\":[\"1873\",\"1874\"],\"AnswerCodes\":[\"1\",\"2\"]}]}"
            },
            {
                "body":"{\"IR\":30,\"CPI\":1.48,\"LOI\":13,\"LiveLink\":\"https://surveys.sample-cube.com?VID=21092&SID=709EEF9B-FC2B-4AA0-9870-107A4B0DB917&LID=3&pid=[#scid#]&uid=[#scid2#]&zid=[#scid3#]\",\"SurveyId\":17916141,\"AccountId\":1,\"UrlTypeId\":1,\"CollectPII\":false,\"IndustryId\":30,\"LanguageId\":3,\"IsManualInc\":false,\"StudyTypeId\":1,\"BillingEntityId\":2,\"IsMobileAllowed\":false,\"IsQuotaLevelCPI\":false,\"IsTabletAllowed\":false,\"UpdateTimeStamp\":\"2023-08-08T06:10:30.38\",\"IsNonMobileAllowed\":true,\"IsSurveyGroupExist\":false,\"Qual_UpdateTimeStamp\":\"2023-08-06T03:08:46.423\",\"Group_UpdateTimeStamp\":\"2023-08-07T06:15:06.98\",\"Quota_UpdateTimeStamp\":\"2023-08-08T05:29:14.58\",\"survey_provider_id\":4,\"qualifications\":[{\"QualificationId\":59,\"UpdateTimeStamp\":\"2023-08-06T03:08:46.423\",\"AnswerIds\":[\"40-54\",\"20-29\"],\"AnswerCodes\":[\"1\",\"1\"]},{\"QualificationId\":60,\"UpdateTimeStamp\":\"2023-08-03T01:45:04.337\",\"AnswerIds\":[\"58\",\"59\"],\"AnswerCodes\":[\"1\",\"2\"]},{\"QualificationId\":631,\"UpdateTimeStamp\":\"2023-08-10T00:21:51.623\",\"AnswerIds\":[\"54149\",\"54151\"],\"AnswerCodes\":[\"2\",\"4\"]}]}"
            }
        ]
    };
    var surveys = [];
    var db = null;
    try {
        if(event.Records) {
            const records = event.Records;
            var db = createDBConnection();
            for(let record of records){
                const surveyData = JSON.parse(record.body);                
                if ('survey_provider_id' in surveyData) {
                    try {
                        await db.beginTransaction();
                        switch (surveyData.survey_provider_id) {
                            case 1:
                            case '1':
                                const lucid = new Lucid(db, surveyData);
                                var result = await lucid.surveySync();
                                surveys.push(result);
                                break;
                            case 4:
                            case '4':
                                const sch = new Schlesinger(db, surveyData);
                                var result = await sch.surveySync();
                                surveys.push(result);
                                break;
                            case 3:
                            case '3':
                                const psObj = new Purespectrum(db, surveyData);
                                var result = await psObj.surveySync();
                                surveys.push(result);
                                break;
                            default:
                                surveys = []
                        }
                        console.log('result', result)
                        surveys.push(result);
                        await db.commit();
                    } catch ( err ) {
                        console.log(err)
                        await db.rollback();
                        throw err;
                    }
                }
            }
        }
    } catch ( err ) {
        console.log(err)
    }
    finally{
        if(db){
            await db.close();
        }
        return {
            statusCode: 200,
            body: JSON.stringify({ surveys })
        }
    }
}
*/

//For testing purpose
/*module.exports.surveySync = async (context) => {	
    const event = {
        "Records": [
            {
                "body": "{\"survey_id\":15770519,\"survey_name\":\"Exciting New Survey #15770519\",\"surveyLocalization\":\"en_US\",\"survey_status\":22,\"field_end_date\":1685381823928,\"category\":\"Exciting New\",\"category_code\":232,\"crtd_on\":1684431424250,\"mod_on\":1684431425499,\"soft_launch\":false,\"click_balancing\":0,\"price_type\":1,\"pii\":false,\"buyer_message\":\"\",\"buyer_id\":651,\"incl_excl\":0,\"cpi\":5.85,\"last_complete_date\":null,\"project_last_complete_date\":null,\"survey_grouping\":{},\"survey_performance\":{\"overall\":{\"ir\":25,\"loi\":15},\"last_block\":{\"ir\":null,\"loi\":null,\"epc\":null,\"acpi\":null,\"ppm\":null,\"oqp\":null,\"bdp\":null,\"bqtp\":null,\"bstp\":null,\"btp\":null}},\"supplier_completes\":{\"needed\":100,\"achieved\":0,\"remaining\":100,\"guaranteed_allocation\":0,\"guaranteed_allocation_remaining\":0},\"pds\":{\"enabled\":false,\"buyer_name\":null},\"channel_type\":null,\"link_security\":2,\"quotas\":[{\"quota_id\":\"220bb036-b5b8-45ac-a636-3007c5b38cd4\",\"quantities\":{\"currently_open\":100,\"remaining\":100,\"achieved\":0},\"criteria\":[{\"qualification_code\":212,\"range_sets\":[{\"units\":311,\"to\":65,\"from\":35}]},{\"qualification_code\":211,\"condition_codes\":[\"111\"]},{\"qualification_code\":218,\"condition_codes\":[\"112\"]}],\"crtd_on\":1684431424307,\"mod_on\":1684431424307,\"last_complete_date\":null}],\"qualifications\":[{\"condition_codes\":[\"111\"],\"qualification_code\":211},{\"range_sets\":[{\"units\":311,\"to\":65,\"from\":35}],\"qualification_code\":212},{\"condition_codes\":[\"112\"],\"qualification_code\":218}],\"survey_provider_id\":\"3\"}"
            },
            {
                "body": "{\"survey_id\":16106582,\"survey_name\":\"Exciting New Survey #16106582\",\"surveyLocalization\":\"en_US\",\"survey_status\":22,\"field_end_date\":1686425547000,\"category\":\"Exciting New\",\"category_code\":232,\"crtd_on\":1685555765859,\"mod_on\":1685561547680,\"soft_launch\":false,\"click_balancing\":0,\"price_type\":1,\"pii\":false,\"buyer_message\":\"\",\"buyer_id\":651,\"incl_excl\":0,\"cpi\":1.2,\"last_complete_date\":null,\"project_last_complete_date\":null,\"survey_grouping\":{},\"survey_performance\":{\"overall\":{\"ir\":30,\"loi\":15},\"last_block\":{\"ir\":null,\"loi\":null,\"epc\":null,\"acpi\":null,\"ppm\":null,\"oqp\":null,\"bdp\":null,\"bqtp\":null,\"bstp\":null,\"btp\":null}},\"supplier_completes\":{\"needed\":35,\"achieved\":0,\"remaining\":35,\"guaranteed_allocation\":0,\"guaranteed_allocation_remaining\":0},\"pds\":{\"enabled\":false,\"buyer_name\":null},\"channel_type\":null,\"link_security\":2,\"quotas\":[{\"quota_id\":\"5ece1723-2c8f-4bb6-8db6-ec610ff23180\",\"quantities\":{\"currently_open\":33,\"remaining\":33,\"achieved\":0},\"criteria\":[{\"qualification_code\":212,\"range_sets\":[{\"units\":311,\"to\":85,\"from\":40}]},{\"qualification_code\":211,\"condition_codes\":[\"112\",\"111\"]},{\"qualification_code\":213,\"range_sets\":[{\"units\":321,\"to\":79999,\"from\":75000},{\"units\":321,\"to\":84999,\"from\":80000},{\"units\":321,\"to\":89999,\"from\":85000},{\"units\":321,\"to\":94999,\"from\":90000},{\"units\":321,\"to\":99999,\"from\":95000},{\"units\":321,\"to\":124999,\"from\":100000},{\"units\":321,\"to\":149999,\"from\":125000},{\"units\":321,\"to\":174999,\"from\":150000},{\"units\":321,\"to\":199999,\"from\":175000},{\"units\":321,\"to\":249999,\"from\":200000}]}],\"crtd_on\":1685555765920,\"mod_on\":1685555765920,\"last_complete_date\":null}],\"qualifications\":[{\"condition_codes\":[\"112\",\"111\"],\"qualification_code\":211},{\"range_sets\":[{\"units\":311,\"to\":85,\"from\":40}],\"qualification_code\":212},{\"range_sets\":[{\"units\":321,\"to\":79999,\"from\":75000},{\"units\":321,\"to\":84999,\"from\":80000},{\"units\":321,\"to\":89999,\"from\":85000},{\"units\":321,\"to\":94999,\"from\":90000},{\"units\":321,\"to\":99999,\"from\":95000},{\"units\":321,\"to\":124999,\"from\":100000},{\"units\":321,\"to\":149999,\"from\":125000},{\"units\":321,\"to\":174999,\"from\":150000},{\"units\":321,\"to\":199999,\"from\":175000},{\"units\":321,\"to\":249999,\"from\":200000}],\"qualification_code\":213}],\"survey_provider_id\":\"3\"}"
            }
        ]
    };
    var surveys = [];
    var db = null;
    try {
        if(event.Records) {
            const records = event.Records;
            var db = createDBConnection();
            for(let record of records){
                const surveyData = JSON.parse(record.body);                
                if ('survey_provider_id' in surveyData) {                    
                    try {
                        await db.beginTransaction();
                        switch (surveyData.survey_provider_id) {
                            case 1:
                            case '1':
                                const lucid = new Lucid(db, surveyData);
                                var result = await lucid.surveySync();
                                surveys.push(result);
                                break;
                            case 4:
                            case '4':
                                const sch = new Schlesinger(db, surveyData);
                                var result = await sch.surveySync();
                                surveys.push(result);
                                break;
                            case 3:
                            case '3':
                                const psObj = new Purespectrum(db, surveyData);
                                var result = await psObj.surveySync();
                                surveys.push(result);
                                break;
                            default:
                                surveys = []
                        }
                        console.log('result', result)
                        surveys.push(result);
                        await db.commit();
                    } catch ( err ) {
                        console.log(err)
                        await db.rollback();
                        throw err;
                    }
                }
            }
        }
    } catch ( err ) {
        console.log(err)
    }
    finally{
        if(db){
            await db.close();
        }
        return {
            statusCode: 200,
            body: JSON.stringify({ surveys })
        }
    }
}*/